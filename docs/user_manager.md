# 用户管理设计

## 1. 基本概念

1. 用户

用户是系统的操作者。
一个用户可以属于1到N个组，1到N个不同的角色。

2. 角色

对许多拥有相同权限的用户的定义，例如管理员，用户。

3. 组

组是组（子组）与用户的集合，一个组可以拥有多个组以及直属于这个组的员工。
每个子组只能属于一个组。
每个组拥有N个角色，N个用户，可以指定1到N个负责人。

它们之间的关系如下图：

![relationship image](./images/group_relationship.png)

## 2. 初始化操作

1. 系统初始化

在开发者完成注册后，系统会创建一个基础组，指定负责人为该开发者，以及最小访问权限角色。
同时创建管理员角色，该角色拥有系统最大权限，与开发者关联。

2. 组初始化

所有的组都需要有上层组（最顶层是基础组，由系统初始化）。
在组创建的过程，需要创建该组对应的角色。

3. 用户注册

用户必须注册在一个组下（若没有，则注册在基础组）。

## 3. 应用场景

1. 添加组

新建一个组，必须指定该组的上层组，同时创建该组对应的最小访问权限角色

2. 修改组

该组的负责人可以修改组的基本属性

3. 修改组关系

上层组可以修改下层组的关系，例如A组拥有B，C两组，B组拥有D，E两组，A组可以把D组划到C组下

4. 修改组的角色权限

只有系统管理员有权限修改

6. 删除组

上层组可以删除下层组
组的删除有多种场景：

* 无限制
* 有用户的情况下不能删除

7. 添加用户

用户注册必须指定组（可以是基础组）
用户加入某个组的同时，也拥有该组定义的角色权限

8. 用户加入组

用户加入组，有以下几种场景：

* 无限制（例如基础组就是无限制加入的，但是加入只有最小访问权限）
* 用户申请加入某个组，需要组或上层组的同意
* 组拉某个用户，需要用户的同意
* 组拉某个用户，不需要用户的同意

9. 用户退出组

用户退出组，有以下场景：

* 无限制
* 需要该组的同意

10. 修改用户信息

只有用户拥有修改权限

11. 用户权限

用户的权限包括两部分：用户自身定义的角色权限，所在组对应的角色权限
用户在加入某个组，获得该组对应的角色以及权限

12. 用户从属关系

每个组有1到N个负责人，负责该组的管理，组负责人是组用户的上司，是子组用户的上司
用户从属关系由组和负责人来体现，例子：

```json
G1组拥有用户U11，U12，U13，其中U11是负责人，则U11是U12和U13的上司
同时G1组拥有子组G11和G12，那么U11也是这两组用户的上司，而U12和U13不是
```